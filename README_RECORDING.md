# PyNVR 녹화 기능 설명서

## 녹화 기능 개요

PyNVR에 연속 녹화 기능이 추가되었습니다. 이 기능을 통해 RTSP 스트림을 파일로 녹화하고 관리할 수 있습니다.

## 주요 기능

### 1. 연속 녹화
- 지정된 시간 단위로 자동 파일 분할 (기본 10분)
- MP4, MKV, AVI 포맷 지원
- 카메라별 독립적인 녹화 제어

### 2. 녹화 관리
- 전체 카메라 동시 녹화 시작/정지
- 개별 카메라 녹화 제어
- 녹화 일시정지/재개 기능
- 디스크 사용량 모니터링

### 3. 파일 관리
- 날짜별 디렉토리 자동 생성
- 오래된 녹화 파일 자동 삭제 (보관 기간 설정 가능)
- 체계적인 파일명 규칙 (camera_id_YYYYMMDD_HHMMSS.ext)

## 사용 방법

### 1. 프로그램 실행
```bash
python main.py
```

### 2. 녹화 컨트롤 위치
- 메인 윈도우 우측에 "Recording Control" 독 위젯이 표시됩니다
- View 메뉴에서 숨기거나 표시할 수 있습니다

### 3. 녹화 시작
1. 녹화 설정 선택:
   - Format: MP4, MKV, AVI 중 선택
   - Duration: 파일 분할 시간 선택 (5분, 10분, 30분, 60분)

2. 녹화 시작:
   - "Start All": 모든 카메라 녹화 시작
   - 개별 카메라 선택 후 "Start": 선택한 카메라만 녹화

### 4. 녹화 상태 확인
- 각 카메라별로 녹화 상태가 표시됩니다:
  - 🔴 REC: 녹화 중
  - ⚫ STOP: 녹화 정지
- 그리드 뷰에서도 녹화 중인 카메라는 빨간 점이 표시됩니다

### 5. 녹화 정지
- "Stop All": 모든 녹화 정지
- 개별 카메라 선택 후 "Stop": 선택한 카메라 녹화 정지

## 파일 저장 위치

녹화 파일은 다음과 같은 구조로 저장됩니다:
```
recordings/
├── cam_01/
│   ├── 20240101/
│   │   ├── cam_01_20240101_090000.mp4
│   │   ├── cam_01_20240101_091000.mp4
│   │   └── ...
│   └── 20240102/
│       └── ...
├── cam_02/
│   └── ...
└── ...
```

## 테스트

### 녹화 기능 테스트
```bash
python test_recording.py
```

이 테스트는:
- 첫 번째 활성 카메라로 녹화 시작
- 10초 녹화
- 일시정지/재개 테스트
- 녹화 정지
- 디스크 사용량 확인

## 시스템 요구사항

- GStreamer 1.0 이상
- PyQt5
- 충분한 디스크 공간 (연속 녹화시 카메라당 약 1-2GB/시간)
- 라즈베리파이의 경우 외장 저장장치 권장

## 주의사항

1. **디스크 공간**: 연속 녹화시 디스크 공간을 주기적으로 확인하세요
2. **네트워크 안정성**: RTSP 연결이 불안정하면 녹화가 중단될 수 있습니다
3. **파일 보관**: 기본 7일 후 자동 삭제되므로 중요한 녹화는 별도 백업하세요
4. **CPU 사용량**: 여러 카메라 동시 녹화시 CPU 부하가 증가합니다

## 문제 해결

### 녹화가 시작되지 않는 경우
1. RTSP URL이 올바른지 확인
2. 카메라가 연결되어 있는지 확인
3. 디스크 공간이 충분한지 확인
4. logs/pynvr_*.log 파일에서 오류 메시지 확인

### 녹화 파일이 재생되지 않는 경우
1. 파일이 완전히 저장되었는지 확인 (녹화 정지 후 생성)
2. VLC 또는 ffplay로 재생 테스트
3. 다른 포맷(MKV, AVI)으로 시도

### 디스크 공간 부족
1. Recording Control에서 디스크 사용량 확인
2. 오래된 녹화 파일 수동 삭제
3. 보관 기간 설정 조정