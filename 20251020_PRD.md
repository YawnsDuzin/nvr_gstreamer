# Product Requirements Document (PRD)
# 네트워크 비디오 레코더 (NVR) 시스템

**문서 버전:** 1.0
**작성일:** 2025-10-20
**작성자:** System Architecture Team
**문서 상태:** Draft

---

## 목차

1. [개요](#1-개요)
2. [프로젝트 배경 및 목적](#2-프로젝트-배경-및-목적)
3. [이해관계자 및 역할](#3-이해관계자-및-역할)
4. [시스템 요구사항](#4-시스템-요구사항)
5. [기술 스택 및 아키텍처](#5-기술-스택-및-아키텍처)
6. [개발환경 설정](#6-개발환경-설정)
7. [기능 요구사항](#7-기능-요구사항)
8. [비기능 요구사항](#8-비기능-요구사항)
9. [데이터베이스 설계](#9-데이터베이스-설계)
10. [설정 항목 정의](#10-설정-항목-정의)
11. [단계별 개발 계획](#11-단계별-개발-계획)
12. [개발 일정 (간트 차트)](#12-개발-일정-간트-차트)
13. [테스트 계획](#13-테스트-계획)
14. [배포 계획](#14-배포-계획)
15. [위험 관리](#15-위험-관리)
16. [개발 유의사항](#16-개발-유의사항)
17. [부록](#17-부록)

---

## 1. 개요

### 1.1 제품명
**PyNVR** - Python 기반 네트워크 비디오 레코더 시스템

### 1.2 제품 버전
Version 1.0.0

### 1.3 문서 목적
본 문서는 PyNVR 시스템의 개발을 위한 상세 요구사항, 기술 사양, 개발 계획 및 구현 가이드라인을 제공합니다.

### 1.4 대상 독자
- 개발팀 (백엔드, 프론트엔드, 임베디드)
- 프로젝트 관리자
- QA 엔지니어
- 시스템 관리자
- 기술 지원팀

---

## 2. 프로젝트 배경 및 목적

### 2.1 비즈니스 배경

현재 시장의 NVR 솔루션들은 다음과 같은 문제점을 가지고 있습니다:

- **높은 하드웨어 요구사항**: 대부분의 상용 NVR 시스템은 고사양 서버를 요구
- **비효율적인 리소스 사용**: 스트리밍과 녹화를 위한 중복 디코딩으로 인한 CPU 낭비
- **제한적인 확장성**: 벤더 종속적이고 커스터마이징이 어려움
- **높은 라이선스 비용**: 카메라 수와 기능에 따른 고비용 구조

### 2.2 프로젝트 목적

#### 주요 목적
1. **임베디드 환경 최적화**: Raspberry Pi 같은 저사양 하드웨어에서 효율적으로 동작
2. **리소스 효율성**: 통합 파이프라인 아키텍처로 CPU 사용률 50% 감소
3. **오픈소스 기반**: 벤더 독립적이고 커스터마이징 가능한 솔루션
4. **확장 가능성**: 모듈화된 구조로 기능 추가 용이

#### 비즈니스 목표
- 중소규모 사업장을 위한 경제적인 NVR 솔루션 제공
- 기존 대비 50% 이상의 비용 절감
- 4채널 기준 Raspberry Pi 4에서 안정적 운영

### 2.3 성공 지표 (KPI)

| 지표 | 목표값 | 측정 방법 |
|------|--------|-----------|
| CPU 사용률 | < 50% (4채널 동시 스트리밍+녹화) | 시스템 모니터링 |
| 메모리 사용량 | < 2GB | 메모리 프로파일링 |
| 녹화 안정성 | 99.9% uptime | 로그 분석 |
| 재연결 시간 | < 15초 | 네트워크 테스트 |
| 레이아웃 전환 시간 | < 1초 | UI 성능 테스트 |

---

## 3. 이해관계자 및 역할

### 3.1 내부 이해관계자

| 역할 | 책임 | 담당자 |
|------|------|--------|
| 프로젝트 관리자 | 일정 관리, 리소스 조정, 이해관계자 커뮤니케이션 | PM |
| 기술 리드 | 아키텍처 설계, 기술 의사결정, 코드 리뷰 | Tech Lead |
| 백엔드 개발자 | 파이프라인 개발, 녹화 시스템 구현 | Backend Dev |
| 프론트엔드 개발자 | UI/UX 구현, 사용자 인터페이스 개발 | Frontend Dev |
| 임베디드 개발자 | 하드웨어 최적화, 플랫폼별 테스트 | Embedded Dev |
| QA 엔지니어 | 테스트 계획 수립, 품질 보증 | QA |
| DevOps 엔지니어 | CI/CD 구축, 배포 자동화 | DevOps |

### 3.2 외부 이해관계자

| 이해관계자 | 관심사항 | 커뮤니케이션 방법 |
|------------|----------|-------------------|
| 최종 사용자 | 사용 편의성, 안정성 | 사용자 피드백, 설문조사 |
| 시스템 관리자 | 설치/유지보수 용이성 | 기술 문서, 교육 |
| 보안 담당자 | 데이터 보안, 접근 제어 | 보안 감사 보고서 |

---

## 4. 시스템 요구사항

### 4.1 사용자 요구사항

#### 4.1.1 기본 사용자 스토리

1. **카메라 관리**
   - "시스템 관리자로서, RTSP 카메라를 쉽게 추가/제거할 수 있어야 한다"
   - "사용자로서, 카메라 목록을 보고 연결 상태를 확인할 수 있어야 한다"

2. **실시간 모니터링**
   - "보안 담당자로서, 최대 4개 카메라를 동시에 모니터링할 수 있어야 한다"
   - "사용자로서, 다양한 레이아웃(1x1, 2x2, 3x3, 4x4)으로 화면을 구성할 수 있어야 한다"

3. **녹화 관리**
   - "관리자로서, 연속 녹화를 설정하고 관리할 수 있어야 한다"
   - "사용자로서, 녹화된 영상을 날짜/시간별로 검색할 수 있어야 한다"

4. **재생 기능**
   - "사용자로서, 녹화된 영상을 타임라인 기반으로 재생할 수 있어야 한다"
   - "조사관으로서, 특정 시간대의 영상을 빠르게 검색할 수 있어야 한다"

### 4.2 시스템 사양

#### 4.2.1 최소 하드웨어 요구사항

| 구성요소 | 최소 사양 | 권장 사양 |
|----------|-----------|-----------|
| CPU | ARM Cortex-A53 1.4GHz (RPi 3B+) | ARM Cortex-A72 1.5GHz (RPi 4) |
| RAM | 1GB | 4GB |
| 저장공간 | 32GB (시스템) + 1TB (녹화) | 64GB (시스템) + 2TB+ (녹화) |
| 네트워크 | 100Mbps Ethernet | Gigabit Ethernet |
| 디스플레이 | 1280x720 | 1920x1080 |

#### 4.2.2 소프트웨어 요구사항

| 구성요소 | 버전 요구사항 |
|----------|---------------|
| 운영체제 | Raspberry Pi OS (Bullseye) / Ubuntu 20.04+ |
| Python | 3.8+ |
| GStreamer | 1.18+ |
| PyQt | 5.15+ |
| PostgreSQL | 13+ (옵션) |

---

## 5. 기술 스택 및 아키텍처

### 5.1 기술 스택 선정 근거

#### 5.1.1 핵심 기술 선택

| 기술 | 선택 | 선정 이유 |
|------|------|-----------|
| **언어** | Python 3.8+ | - 빠른 프로토타이핑<br>- 풍부한 라이브러리 생태계<br>- GStreamer 바인딩 지원 우수 |
| **비디오 처리** | GStreamer | - 산업 표준 멀티미디어 프레임워크<br>- 하드웨어 가속 지원<br>- 파이프라인 기반 아키텍처 |
| **GUI 프레임워크** | PyQt5 | - 크로스 플랫폼 지원<br>- 네이티브 성능<br>- 풍부한 위젯 라이브러리 |
| **설정 관리** | YAML | - 사람이 읽기 쉬운 포맷<br>- 계층적 구조 지원<br>- 주석 지원 |
| **로깅** | Loguru | - 간편한 설정<br>- 자동 로테이션<br>- 구조화된 로깅 |
| **데이터베이스** | SQLite/PostgreSQL | - SQLite: 경량 임베디드<br>- PostgreSQL: 확장성 |

### 5.2 시스템 아키텍처

#### 5.2.1 상위 수준 아키텍처

```
┌─────────────────────────────────────────────┐
│                  UI Layer                   │
│         (PyQt5 - Main Window)               │
└─────────────┬───────────────────────────────┘
              │
┌─────────────▼───────────────────────────────┐
│           Application Layer                 │
│   ┌─────────────┬─────────────┬──────────┐ │
│   │  Camera     │  Recording  │ Playback │ │
│   │  Manager    │  Manager    │ Manager  │ │
│   └─────────────┴─────────────┴──────────┘ │
└─────────────┬───────────────────────────────┘
              │
┌─────────────▼───────────────────────────────┐
│           Pipeline Layer                    │
│   ┌─────────────────────────────────────┐  │
│   │     Unified Pipeline Manager        │  │
│   │  (Streaming + Recording + Valves)   │  │
│   └─────────────────────────────────────┘  │
└─────────────┬───────────────────────────────┘
              │
┌─────────────▼───────────────────────────────┐
│           GStreamer Core                    │
│    (Decode → Tee → Stream/Record)          │
└─────────────────────────────────────────────┘
```

#### 5.2.2 통합 파이프라인 아키텍처 (핵심 혁신)

```
                    ┌─────────────────┐
                    │   RTSP Source   │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │    Depayload    │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │   H264 Parse    │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │     Decode      │
                    │  (HW/SW Auto)   │
                    └────────┬────────┘
                             │
                    ┌────────▼────────┐
                    │       Tee       │
                    └───┬────────┬────┘
                        │        │
           ┌────────────▼──┐  ┌──▼────────────┐
           │ Stream Valve  │  │ Record Valve  │
           └────────┬──────┘  └──┬────────────┘
                    │             │
           ┌────────▼──────┐  ┌──▼────────────┐
           │   Display     │  │   MP4 Mux     │
           │   Sink        │  │   File Sink   │
           └───────────────┘  └───────────────┘
```

### 5.3 모듈 구조

```
nvr_gstreamer/
├── main.py                 # 진입점
├── config/                 # 설정 관리
│   ├── __init__.py
│   ├── config_manager.py   # 설정 로더/저장
│   └── schemas.py         # 설정 스키마 정의
├── streaming/             # 스트리밍 코어
│   ├── __init__.py
│   ├── unified_pipeline.py # 통합 파이프라인
│   ├── pipeline_manager.py # 파이프라인 추상화
│   └── camera_stream.py   # 카메라 스트림 핸들러
├── recording/             # 녹화 관리
│   ├── __init__.py
│   ├── recording_manager.py # 녹화 관리자
│   └── storage_manager.py # 저장공간 관리
├── playback/              # 재생 기능
│   ├── __init__.py
│   ├── playback_manager.py # 재생 관리자
│   └── timeline.py        # 타임라인 컨트롤
├── ui/                    # 사용자 인터페이스
│   ├── __init__.py
│   ├── main_window.py    # 메인 윈도우
│   ├── grid_view.py      # 그리드 뷰
│   ├── video_widget.py   # 비디오 위젯
│   ├── camera_list.py    # 카메라 목록
│   └── controls/          # UI 컨트롤
├── database/              # 데이터베이스
│   ├── __init__.py
│   ├── models.py         # 데이터 모델
│   └── repository.py     # 데이터 접근 계층
├── utils/                 # 유틸리티
│   ├── __init__.py
│   ├── logger.py         # 로깅 설정
│   └── validators.py     # 유효성 검증
└── tests/                 # 테스트
    ├── unit/             # 단위 테스트
    ├── integration/      # 통합 테스트
    └── performance/      # 성능 테스트
```

---

## 6. 개발환경 설정

### 6.1 개발 도구 설정

#### 6.1.1 필수 개발 도구

```bash
# 1. Python 환경 설정
sudo apt-get update
sudo apt-get install -y python3.8 python3.8-venv python3-pip

# 2. 가상환경 생성
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# venv\Scripts\activate  # Windows

# 3. 개발 도구 설치
pip install --upgrade pip setuptools wheel
pip install black flake8 mypy pytest pytest-cov
pip install pre-commit
```

#### 6.1.2 GStreamer 개발 환경

```bash
# Ubuntu/Debian
sudo apt-get install -y \
    gstreamer1.0-tools \
    gstreamer1.0-plugins-base \
    gstreamer1.0-plugins-good \
    gstreamer1.0-plugins-bad \
    gstreamer1.0-plugins-ugly \
    gstreamer1.0-libav \
    libgstreamer1.0-dev \
    libgstreamer-plugins-base1.0-dev \
    python3-gi python3-gi-cairo \
    gir1.2-gstreamer-1.0

# Raspberry Pi 하드웨어 가속
sudo apt-get install -y gstreamer1.0-omx-generic  # Pi 3
# 또는
sudo apt-get install -y gstreamer1.0-v4l2  # Pi 4
```

#### 6.1.3 IDE 설정 (VS Code)

```json
// .vscode/settings.json
{
    "python.linting.enabled": true,
    "python.linting.flake8Enabled": true,
    "python.formatting.provider": "black",
    "python.testing.pytestEnabled": true,
    "files.exclude": {
        "**/__pycache__": true,
        "**/*.pyc": true
    }
}
```

### 6.2 개발 프로세스

#### 6.2.1 브랜치 전략 (Git Flow)

```
main
  └── develop
       ├── feature/camera-management
       ├── feature/unified-pipeline
       ├── feature/recording-system
       └── feature/ui-implementation
```

#### 6.2.2 커밋 컨벤션

```
<type>(<scope>): <subject>

<body>

<footer>

Types: feat, fix, docs, style, refactor, test, chore
Example: feat(pipeline): 통합 파이프라인 구현
```

### 6.3 CI/CD 파이프라인

```yaml
# .github/workflows/ci.yml
name: CI Pipeline

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt
      - name: Run tests
        run: pytest --cov=nvr_gstreamer tests/
      - name: Run linting
        run: |
          flake8 nvr_gstreamer/
          mypy nvr_gstreamer/
```

---

## 7. 기능 요구사항

### 7.1 핵심 기능 (P0 - Must Have)

#### 7.1.1 카메라 관리 (FR-CAM)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-CAM-001 | RTSP 카메라 추가 | RTSP URL을 통한 카메라 추가 | P0 |
| FR-CAM-002 | 카메라 연결 상태 확인 | 실시간 연결 상태 모니터링 | P0 |
| FR-CAM-003 | 자동 재연결 | 연결 실패 시 자동 재연결 (최대 5회) | P0 |
| FR-CAM-004 | 카메라 설정 저장 | YAML 파일로 설정 영구 저장 | P0 |

#### 7.1.2 실시간 스트리밍 (FR-STR)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-STR-001 | 멀티 채널 표시 | 최대 4채널 동시 표시 | P0 |
| FR-STR-002 | 그리드 레이아웃 | 1x1, 2x2, 3x3, 4x4 레이아웃 지원 | P0 |
| FR-STR-003 | 레이아웃 전환 | 스트림 중단 없이 레이아웃 변경 | P0 |
| FR-STR-004 | 전체화면 모드 | 개별 채널 전체화면 표시 | P0 |

#### 7.1.3 녹화 시스템 (FR-REC)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-REC-001 | 연속 녹화 | 24/7 연속 녹화 지원 | P0 |
| FR-REC-002 | 파일 로테이션 | 설정 가능한 간격(5/10/30/60분) | P0 |
| FR-REC-003 | 저장 경로 관리 | 날짜별 디렉토리 자동 생성 | P0 |
| FR-REC-004 | 동적 녹화 제어 | Valve 기반 녹화 시작/중지 | P0 |

### 7.2 추가 기능 (P1 - Should Have)

#### 7.2.1 재생 시스템 (FR-PLY)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-PLY-001 | 타임라인 탐색 | 시간대별 영상 검색 | P1 |
| FR-PLY-002 | 재생 속도 제어 | 0.5x ~ 4x 속도 제어 | P1 |
| FR-PLY-003 | 구간 반복 | A-B 구간 반복 재생 | P1 |
| FR-PLY-004 | 썸네일 미리보기 | 타임라인 썸네일 표시 | P1 |

#### 7.2.2 시스템 관리 (FR-SYS)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-SYS-001 | 디스크 관리 | 저장 공간 모니터링 | P1 |
| FR-SYS-002 | 자동 정리 | 오래된 녹화 파일 자동 삭제 | P1 |
| FR-SYS-003 | 시스템 상태 표시 | CPU, 메모리, 네트워크 사용률 | P1 |
| FR-SYS-004 | 로그 관리 | 로그 레벨 설정, 로테이션 | P1 |

### 7.3 향후 기능 (P2 - Nice to Have)

| ID | 기능 | 설명 | 우선순위 |
|----|------|------|----------|
| FR-FUT-001 | 모션 감지 | 움직임 감지 및 알림 | P2 |
| FR-FUT-002 | 이벤트 북마크 | 중요 이벤트 마킹 | P2 |
| FR-FUT-003 | 원격 접속 | 웹/모바일 원격 모니터링 | P2 |
| FR-FUT-004 | AI 분석 | 객체 인식, 얼굴 인식 | P2 |
| FR-FUT-005 | 클라우드 백업 | 녹화 파일 클라우드 업로드 | P2 |

---

## 8. 비기능 요구사항

### 8.1 성능 요구사항 (NFR-PERF)

| ID | 항목 | 요구사항 | 측정 기준 |
|----|------|----------|-----------|
| NFR-PERF-001 | CPU 사용률 | 4채널 동시 스트리밍+녹화 시 < 50% | Raspberry Pi 4 기준 |
| NFR-PERF-002 | 메모리 사용량 | < 2GB RAM | 4채널 운영 시 |
| NFR-PERF-003 | 시작 시간 | < 30초 | 애플리케이션 구동 |
| NFR-PERF-004 | 레이턴시 | < 200ms | RTSP → 화면 표시 |
| NFR-PERF-005 | 프레임레이트 | ≥ 25 fps | 각 채널별 |

### 8.2 신뢰성 요구사항 (NFR-REL)

| ID | 항목 | 요구사항 | 측정 기준 |
|----|------|----------|-----------|
| NFR-REL-001 | 가용성 | 99.9% uptime | 월간 기준 |
| NFR-REL-002 | 복구 시간 | < 15초 | 네트워크 재연결 |
| NFR-REL-003 | 데이터 무결성 | 0% 손실 | 녹화 파일 |
| NFR-REL-004 | 오류 처리 | 모든 예외 처리 | 크래시 방지 |

### 8.3 보안 요구사항 (NFR-SEC)

| ID | 항목 | 요구사항 | 구현 방법 |
|----|------|----------|-----------|
| NFR-SEC-001 | 인증 | 사용자 인증 필수 | 로컬 인증 |
| NFR-SEC-002 | 암호화 | 설정 파일 암호화 | AES-256 |
| NFR-SEC-003 | 접근 제어 | 역할 기반 접근 | Admin/User |
| NFR-SEC-004 | 감사 로그 | 모든 작업 로깅 | 감사 추적 |

### 8.4 사용성 요구사항 (NFR-USE)

| ID | 항목 | 요구사항 | 측정 기준 |
|----|------|----------|-----------|
| NFR-USE-001 | 학습 곡선 | < 30분 | 기본 기능 숙지 |
| NFR-USE-002 | 응답 시간 | < 100ms | UI 반응 시간 |
| NFR-USE-003 | 에러 메시지 | 명확한 안내 | 사용자 이해 가능 |
| NFR-USE-004 | 키보드 단축키 | 주요 기능 지원 | 10개 이상 |

### 8.5 호환성 요구사항 (NFR-COM)

| ID | 항목 | 요구사항 | 지원 범위 |
|----|------|----------|-----------|
| NFR-COM-001 | OS 지원 | Linux 기반 | Ubuntu 20.04+, Raspberry Pi OS |
| NFR-COM-002 | 카메라 프로토콜 | RTSP/RTMP | H.264/H.265 |
| NFR-COM-003 | 화면 해상도 | 720p ~ 4K | 자동 스케일링 |
| NFR-COM-004 | 파일 포맷 | MP4, MKV, AVI | 설정 가능 |

---

## 9. 데이터베이스 설계

### 9.1 데이터베이스 선택

#### 9.1.1 단계별 접근
- **Phase 1 (MVP)**: SQLite - 설정 및 메타데이터 저장
- **Phase 2 (확장)**: PostgreSQL - 멀티유저, 이벤트 로깅, 분석

### 9.2 테이블 정의서

#### 9.2.1 카메라 정보 (cameras)

```sql
CREATE TABLE cameras (
    camera_id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    rtsp_url VARCHAR(500) NOT NULL,
    username VARCHAR(50),
    password VARCHAR(100),  -- 암호화 저장
    enabled BOOLEAN DEFAULT true,
    use_hardware_decode BOOLEAN DEFAULT false,
    recording_enabled BOOLEAN DEFAULT false,
    motion_detection BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_connected TIMESTAMP,
    status VARCHAR(20) DEFAULT 'DISCONNECTED',
    UNIQUE(rtsp_url)
);

CREATE INDEX idx_cameras_enabled ON cameras(enabled);
CREATE INDEX idx_cameras_status ON cameras(status);
```

#### 9.2.2 녹화 메타데이터 (recordings)

```sql
CREATE TABLE recordings (
    recording_id SERIAL PRIMARY KEY,
    camera_id VARCHAR(50) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT,
    duration_seconds INTEGER,
    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP NOT NULL,
    format VARCHAR(10) DEFAULT 'mp4',
    resolution VARCHAR(20),
    fps INTEGER,
    codec VARCHAR(20),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_deleted BOOLEAN DEFAULT false,
    FOREIGN KEY (camera_id) REFERENCES cameras(camera_id) ON DELETE CASCADE
);

CREATE INDEX idx_recordings_camera ON recordings(camera_id);
CREATE INDEX idx_recordings_time ON recordings(start_time, end_time);
CREATE INDEX idx_recordings_deleted ON recordings(is_deleted);
```

#### 9.2.3 이벤트 로그 (events)

```sql
CREATE TABLE events (
    event_id SERIAL PRIMARY KEY,
    camera_id VARCHAR(50),
    event_type VARCHAR(50) NOT NULL,  -- MOTION, CONNECTION_LOST, DISK_FULL, etc
    severity VARCHAR(20) NOT NULL,     -- INFO, WARNING, ERROR, CRITICAL
    description TEXT,
    metadata JSON,
    occurred_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    acknowledged BOOLEAN DEFAULT false,
    acknowledged_by VARCHAR(50),
    acknowledged_at TIMESTAMP,
    FOREIGN KEY (camera_id) REFERENCES cameras(camera_id) ON DELETE SET NULL
);

CREATE INDEX idx_events_camera ON events(camera_id);
CREATE INDEX idx_events_type ON events(event_type);
CREATE INDEX idx_events_time ON events(occurred_at);
CREATE INDEX idx_events_severity ON events(severity);
```

#### 9.2.4 시스템 설정 (system_config)

```sql
CREATE TABLE system_config (
    config_key VARCHAR(100) PRIMARY KEY,
    config_value TEXT NOT NULL,
    value_type VARCHAR(20) NOT NULL,  -- STRING, INTEGER, BOOLEAN, JSON
    category VARCHAR(50),
    description TEXT,
    is_encrypted BOOLEAN DEFAULT false,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 기본 설정 데이터
INSERT INTO system_config (config_key, config_value, value_type, category) VALUES
('recording.path', '/var/recordings', 'STRING', 'recording'),
('recording.rotation_minutes', '10', 'INTEGER', 'recording'),
('recording.retention_days', '30', 'INTEGER', 'recording'),
('streaming.default_layout', '2x2', 'STRING', 'streaming'),
('system.max_reconnect_attempts', '5', 'INTEGER', 'system'),
('system.reconnect_delay_seconds', '5', 'INTEGER', 'system');
```

#### 9.2.5 사용자 관리 (users) - Phase 2

```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    role VARCHAR(20) NOT NULL DEFAULT 'viewer',  -- admin, operator, viewer
    is_active BOOLEAN DEFAULT true,
    last_login TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_sessions (
    session_id VARCHAR(100) PRIMARY KEY,
    user_id INTEGER NOT NULL,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
```

#### 9.2.6 감사 로그 (audit_logs)

```sql
CREATE TABLE audit_logs (
    log_id SERIAL PRIMARY KEY,
    user_id INTEGER,
    action VARCHAR(100) NOT NULL,
    entity_type VARCHAR(50),  -- camera, recording, system, etc
    entity_id VARCHAR(100),
    old_value JSON,
    new_value JSON,
    ip_address VARCHAR(45),
    performed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE SET NULL
);

CREATE INDEX idx_audit_user ON audit_logs(user_id);
CREATE INDEX idx_audit_action ON audit_logs(action);
CREATE INDEX idx_audit_time ON audit_logs(performed_at);
```

### 9.3 데이터 관계도 (ERD)

```
┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│   cameras   │────<│  recordings  │     │   events    │
└─────────────┘     └──────────────┘     └─────────────┘
       │                                         │
       └─────────────────────────────────────────┘
                            │
                    ┌───────▼────────┐
                    │  system_config  │
                    └─────────────────┘

┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│    users    │────<│user_sessions │     │ audit_logs  │
└─────────────┘     └──────────────┘     └─────────────┘
```

---

## 10. 설정 항목 정의

### 10.1 애플리케이션 설정 (config.yaml)

```yaml
# Application Configuration
app:
  name: "PyNVR"
  version: "1.0.0"
  debug: false
  log_level: "INFO"  # DEBUG, INFO, WARNING, ERROR

# System Settings
system:
  locale: "ko_KR"
  timezone: "Asia/Seoul"
  auto_start: true
  minimize_to_tray: false

# UI Configuration
ui:
  theme: "dark"  # dark, light
  default_layout: "2x2"  # 1x1, 2x2, 3x3, 4x4
  fullscreen_on_start: false
  show_timestamp: true
  show_camera_name: true
  osd_font_size: 12
  window_state:
    width: 1920
    height: 1080
    x: 0
    y: 0

# Streaming Configuration
streaming:
  use_hardware_acceleration: true
  decoder_preference:  # 우선순위 순서
    - "v4l2h264dec"    # RPi 4 HW
    - "omxh264dec"     # RPi 3 HW
    - "avdec_h264"     # SW fallback
  buffer_size: 10485760  # 10MB
  latency_ms: 200
  tcp_timeout: 10000

# Recording Configuration
recording:
  enabled: true
  base_path: "./recordings"
  file_format: "mp4"  # mp4, mkv, avi
  rotation_minutes: 10  # 5, 10, 30, 60
  retention_days: 30
  max_file_size_mb: 1024
  pre_record_seconds: 5
  post_record_seconds: 5
  codec: "h264"  # h264, h265
  container_format: "mp4"
  fragment_duration_ms: 1000

# Camera Configuration
cameras:
  max_cameras: 16
  default_resolution: "1280x720"
  default_fps: 25
  auto_reconnect: true
  max_reconnect_attempts: 5
  reconnect_delay_seconds: 5
  connection_timeout: 10

# Network Configuration
network:
  rtsp_transport: "tcp"  # tcp, udp, http, udp_multicast
  multicast_iface: "eth0"
  bandwidth_limit_mbps: 0  # 0 = unlimited
  dns_servers:
    - "8.8.8.8"
    - "8.8.4.4"

# Performance Tuning
performance:
  max_cpu_percent: 80
  max_memory_mb: 2048
  pipeline_queue_size: 200
  max_dropped_frames: 10
  enable_gpu: true
  gpu_device: "/dev/dri/renderD128"

# Notification Settings
notifications:
  enabled: true
  email:
    smtp_server: "smtp.gmail.com"
    smtp_port: 587
    use_tls: true
    from_address: "nvr@example.com"
    to_addresses:
      - "admin@example.com"
  events:
    connection_lost: true
    disk_full: true
    motion_detected: false
    recording_error: true

# Database Configuration
database:
  type: "sqlite"  # sqlite, postgresql
  sqlite:
    path: "./data/nvr.db"
  postgresql:
    host: "localhost"
    port: 5432
    database: "nvr"
    username: "nvr_user"
    password: ""  # 암호화 저장
    pool_size: 10

# Logging Configuration
logging:
  enabled: true
  log_path: "./logs"
  max_size_mb: 100
  rotation_count: 10
  format: "json"  # json, text
  include_console: true
  levels:
    application: "INFO"
    gstreamer: "WARNING"
    database: "INFO"

# Security Settings
security:
  require_authentication: false
  session_timeout_minutes: 60
  max_login_attempts: 3
  password_min_length: 8
  enable_ssl: false
  ssl_cert_path: ""
  ssl_key_path: ""
```

### 10.2 카메라별 설정 (cameras.yaml)

```yaml
cameras:
  - camera_id: "cam_01"
    name: "정문 카메라"
    rtsp_url: "rtsp://admin:password@192.168.0.10:554/stream"
    enabled: true
    settings:
      resolution: "1920x1080"
      fps: 30
      bitrate: 4096
      use_hardware_decode: true
      recording_enabled: true
      motion_detection: false
      motion_sensitivity: 50

  - camera_id: "cam_02"
    name: "주차장 카메라"
    rtsp_url: "rtsp://admin:password@192.168.0.11:554/stream"
    enabled: true
    settings:
      resolution: "1280x720"
      fps: 25
      bitrate: 2048
      use_hardware_decode: false
      recording_enabled: true
      motion_detection: true
      motion_sensitivity: 70
      motion_areas:  # 모션 감지 영역
        - x: 100
          y: 100
          width: 500
          height: 300
```

### 10.3 환경 변수 (.env)

```bash
# Environment Variables
NODE_ENV=production
LOG_LEVEL=INFO

# GStreamer
GST_DEBUG=2
GST_DEBUG_FILE=./logs/gstreamer.log
GST_PLUGIN_PATH=/usr/lib/gstreamer-1.0

# Hardware Acceleration
OMX_LIBRARY=/usr/lib/libomxil-bellagio.so
LIBVA_DRIVER_NAME=i965

# System Paths
DATA_PATH=/var/lib/nvr
CONFIG_PATH=/etc/nvr
LOG_PATH=/var/log/nvr
RECORDING_PATH=/mnt/storage/recordings

# Database
DB_TYPE=sqlite
DB_PATH=/var/lib/nvr/nvr.db

# Security
JWT_SECRET=change_this_secret_key
ENCRYPTION_KEY=change_this_encryption_key
```

---

## 11. 단계별 개발 계획

### 11.1 Phase 1: 기반 구축 (4주)

#### Week 1-2: 개발 환경 및 프로젝트 구조
```
1. 개발 환경 구축
   - Python 가상환경 설정
   - GStreamer 설치 및 테스트
   - PyQt5 환경 구성
   - Git 저장소 초기화

2. 프로젝트 구조 생성
   - 디렉토리 구조 생성
   - 기본 패키지 구성
   - 로깅 시스템 구현
   - 설정 관리 모듈 구현

3. 기본 테스트 환경
   - pytest 설정
   - CI/CD 파이프라인 구성
   - 코드 품질 도구 설정
```

#### Week 3-4: GStreamer 파이프라인 프로토타입
```
1. 단일 RTSP 스트림 테스트
   - RTSP 소스 연결
   - 디코딩 파이프라인 구현
   - 화면 출력 테스트

2. 통합 파이프라인 설계
   - Tee 엘리먼트 구현
   - Valve 제어 로직
   - 스트리밍/녹화 분기 테스트

3. 하드웨어 디코더 통합
   - 디코더 자동 감지
   - 플랫폼별 최적화
```

### 11.2 Phase 2: 핵심 기능 구현 (6주)

#### Week 5-6: 카메라 관리 시스템
```
1. CameraStream 클래스 구현
   - RTSP 연결 관리
   - 상태 추적 시스템
   - 자동 재연결 로직

2. CameraManager 구현
   - 다중 카메라 관리
   - 리소스 할당
   - 이벤트 처리
```

#### Week 7-8: UI 기본 구현
```
1. MainWindow 구현
   - 기본 레이아웃 구성
   - 메뉴 시스템
   - 상태바

2. GridView 위젯 구현
   - 다양한 레이아웃 지원
   - 동적 크기 조정
   - 채널 할당 로직

3. VideoWidget 구현
   - GStreamer 통합
   - 윈도우 핸들 관리
   - OSD 오버레이
```

#### Week 9-10: 녹화 시스템
```
1. RecordingManager 구현
   - 파일 시스템 관리
   - 로테이션 로직
   - 메타데이터 저장

2. 녹화 제어 UI
   - 녹화 시작/중지
   - 설정 인터페이스
   - 상태 표시
```

### 11.3 Phase 3: 기능 확장 (4주)

#### Week 11-12: 재생 시스템
```
1. PlaybackManager 구현
   - 녹화 파일 검색
   - GStreamer 재생 파이프라인
   - 시간 탐색 기능

2. 타임라인 UI
   - 타임라인 위젯
   - 썸네일 생성
   - 재생 컨트롤
```

#### Week 13-14: 시스템 관리 기능
```
1. 저장공간 관리
   - 디스크 모니터링
   - 자동 정리 기능
   - 알림 시스템

2. 시스템 모니터링
   - 리소스 사용률 추적
   - 성능 메트릭 수집
   - 대시보드 UI
```

### 11.4 Phase 4: 안정화 및 최적화 (4주)

#### Week 15-16: 테스트 및 버그 수정
```
1. 통합 테스트
   - 전체 시나리오 테스트
   - 스트레스 테스트
   - 장기 실행 테스트

2. 버그 수정
   - 메모리 누수 해결
   - 예외 처리 강화
   - UI 반응성 개선
```

#### Week 17-18: 성능 최적화
```
1. 프로파일링
   - CPU 사용률 분석
   - 메모리 프로파일링
   - I/O 병목 분석

2. 최적화
   - 파이프라인 튜닝
   - 캐싱 전략 구현
   - 스레드 최적화
```

### 11.5 Phase 5: 배포 준비 (2주)

#### Week 19-20: 패키징 및 배포
```
1. 패키징
   - 설치 스크립트 작성
   - 의존성 번들링
   - 플랫폼별 패키지 생성

2. 문서화
   - 사용자 매뉴얼
   - API 문서
   - 관리자 가이드

3. 배포
   - 베타 테스트
   - 피드백 수집
   - 최종 릴리즈
```

---

## 12. 개발 일정 (간트 차트)

### 12.1 전체 일정 개요 (20주)

```
프로젝트 타임라인 (2025년 1월 ~ 5월)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Phase 1: 기반 구축 (4주)
├─ 개발 환경 설정      [■■■■■■■■░░] W1-W2
├─ 프로젝트 구조       [■■■■■■■■░░] W1-W2
└─ 파이프라인 프로토타입 [░░■■■■■■■■] W3-W4

Phase 2: 핵심 기능 (6주)
├─ 카메라 관리         [■■■■■■■■░░░░░░░░] W5-W6
├─ UI 기본 구현       [░░■■■■■■■■░░░░░░] W7-W8
└─ 녹화 시스템         [░░░░■■■■■■■■░░░░] W9-W10

Phase 3: 기능 확장 (4주)
├─ 재생 시스템         [■■■■■■■■░░] W11-W12
└─ 시스템 관리         [░░■■■■■■■■] W13-W14

Phase 4: 안정화 (4주)
├─ 테스트/버그수정     [■■■■■■■■░░] W15-W16
└─ 성능 최적화         [░░■■■■■■■■] W17-W18

Phase 5: 배포 (2주)
└─ 패키징/문서화       [■■■■■■■■■■] W19-W20

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 12.2 상세 간트 차트

```mermaid
gantt
    title NVR 시스템 개발 일정
    dateFormat  YYYY-MM-DD
    section Phase 1
    개발환경 설정           :a1, 2025-01-06, 2w
    프로젝트 구조 생성      :a2, 2025-01-06, 2w
    GStreamer 프로토타입    :a3, 2025-01-20, 2w

    section Phase 2
    카메라 관리 시스템      :b1, 2025-02-03, 2w
    UI 기본 구현           :b2, 2025-02-17, 2w
    녹화 시스템            :b3, 2025-03-03, 2w

    section Phase 3
    재생 시스템            :c1, 2025-03-17, 2w
    시스템 관리 기능        :c2, 2025-03-31, 2w

    section Phase 4
    통합 테스트            :d1, 2025-04-14, 1w
    버그 수정             :d2, 2025-04-21, 1w
    성능 프로파일링        :d3, 2025-04-28, 1w
    최적화               :d4, 2025-05-05, 1w

    section Phase 5
    패키징               :e1, 2025-05-12, 1w
    문서화               :e2, 2025-05-12, 1w
    배포 준비             :e3, 2025-05-19, 1w
```

### 12.3 마일스톤

| 마일스톤 | 날짜 | 산출물 |
|----------|------|--------|
| M1: 프로토타입 완료 | 2025-02-02 | 단일 스트림 파이프라인 동작 |
| M2: MVP 완료 | 2025-03-16 | 4채널 스트리밍 + 녹화 |
| M3: 알파 버전 | 2025-04-13 | 전체 기능 구현 완료 |
| M4: 베타 버전 | 2025-05-11 | 테스트 및 최적화 완료 |
| M5: 정식 출시 | 2025-05-25 | v1.0.0 릴리즈 |

### 12.4 리소스 계획

| 단계 | 필요 인력 | 주요 역할 |
|------|-----------|-----------|
| Phase 1 | 2명 | 백엔드 개발자 1, DevOps 1 |
| Phase 2 | 4명 | 백엔드 2, 프론트엔드 1, 임베디드 1 |
| Phase 3 | 3명 | 백엔드 1, 프론트엔드 1, QA 1 |
| Phase 4 | 3명 | 개발자 2, QA 1 |
| Phase 5 | 2명 | DevOps 1, 기술 문서 작성자 1 |

---

## 13. 테스트 계획

### 13.1 테스트 전략

#### 13.1.1 테스트 레벨

```
단위 테스트 (Unit Test) - 70% Coverage
    ↓
통합 테스트 (Integration Test) - 주요 시나리오
    ↓
시스템 테스트 (System Test) - E2E 시나리오
    ↓
인수 테스트 (Acceptance Test) - 사용자 요구사항
```

### 13.2 테스트 케이스

#### 13.2.1 단위 테스트

```python
# test_pipeline_manager.py
def test_pipeline_creation():
    """파이프라인 생성 테스트"""

def test_decoder_selection():
    """디코더 자동 선택 테스트"""

def test_valve_control():
    """Valve 제어 테스트"""

# test_camera_stream.py
def test_connection_handling():
    """연결 처리 테스트"""

def test_auto_reconnection():
    """자동 재연결 테스트"""
```

#### 13.2.2 통합 테스트

| 테스트 ID | 테스트 항목 | 예상 결과 |
|-----------|------------|-----------|
| IT-001 | 4채널 동시 스트리밍 | 모든 채널 정상 표시 |
| IT-002 | 레이아웃 전환 중 스트리밍 | 끊김 없이 전환 |
| IT-003 | 스트리밍+녹화 동시 실행 | CPU < 50% |
| IT-004 | 네트워크 장애 복구 | 15초 내 재연결 |
| IT-005 | 파일 로테이션 | 정확한 시간 간격 |

#### 13.2.3 성능 테스트

```bash
# 부하 테스트 스크립트
python tests/performance/load_test.py \
    --cameras 4 \
    --duration 3600 \
    --recording enabled
```

### 13.3 테스트 환경

| 환경 | 용도 | 구성 |
|------|------|------|
| 개발 | 단위/통합 테스트 | 로컬 Docker |
| 스테이징 | 시스템 테스트 | Raspberry Pi 4 |
| 프로덕션 | 인수 테스트 | 실제 환경 |

---

## 14. 배포 계획

### 14.1 배포 전략

#### 14.1.1 배포 방식
- **Debian 패키지 (.deb)**: Ubuntu/Raspberry Pi OS
- **Docker 이미지**: 컨테이너 환경
- **소스 배포**: GitHub 릴리즈

### 14.2 설치 스크립트

```bash
#!/bin/bash
# install.sh - NVR 시스템 설치 스크립트

set -e

echo "PyNVR Installation Script v1.0.0"
echo "================================"

# 1. 시스템 업데이트
sudo apt-get update

# 2. 의존성 설치
sudo apt-get install -y \
    python3.8 python3-pip \
    gstreamer1.0-tools \
    gstreamer1.0-plugins-* \
    python3-gi python3-gi-cairo

# 3. Python 패키지 설치
pip3 install -r requirements.txt

# 4. 시스템 서비스 등록
sudo cp nvr.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable nvr.service

# 5. 디렉토리 생성
sudo mkdir -p /var/lib/nvr/recordings
sudo mkdir -p /var/log/nvr
sudo mkdir -p /etc/nvr

# 6. 설정 파일 복사
sudo cp config/config.yaml /etc/nvr/

echo "Installation completed successfully!"
```

### 14.3 시스템 서비스 파일

```ini
# nvr.service
[Unit]
Description=PyNVR Network Video Recorder
After=network.target

[Service]
Type=simple
User=nvr
Group=nvr
WorkingDirectory=/opt/nvr
ExecStart=/usr/bin/python3 /opt/nvr/main.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

---

## 15. 위험 관리

### 15.1 기술적 위험

| 위험 요소 | 발생 확률 | 영향도 | 대응 방안 |
|-----------|-----------|--------|-----------|
| GStreamer 호환성 문제 | 중 | 높음 | 다양한 플랫폼 조기 테스트 |
| 하드웨어 디코더 미지원 | 중 | 중간 | 소프트웨어 폴백 구현 |
| 메모리 누수 | 높음 | 높음 | 정기적 프로파일링, 자동 재시작 |
| 네트워크 대역폭 부족 | 중 | 중간 | 적응형 비트레이트, 품질 조정 |
| 저장 공간 부족 | 높음 | 중간 | 자동 정리, 알림 시스템 |

### 15.2 프로젝트 위험

| 위험 요소 | 발생 확률 | 영향도 | 대응 방안 |
|-----------|-----------|--------|-----------|
| 일정 지연 | 중 | 높음 | 버퍼 시간 확보, MVP 우선 |
| 인력 부족 | 낮음 | 높음 | 교차 교육, 문서화 강화 |
| 요구사항 변경 | 중 | 중간 | 애자일 방법론, 단계별 검토 |
| 라이선스 이슈 | 낮음 | 높음 | 오픈소스 라이선스 검토 |

### 15.3 위험 모니터링

```python
# 위험 지표 모니터링
RISK_INDICATORS = {
    "memory_usage": {"threshold": 80, "action": "restart"},
    "cpu_usage": {"threshold": 90, "action": "throttle"},
    "disk_usage": {"threshold": 85, "action": "cleanup"},
    "connection_failures": {"threshold": 10, "action": "alert"},
    "frame_drops": {"threshold": 5, "action": "reduce_quality"}
}
```

---

## 16. 개발 유의사항

### 16.1 코딩 표준

#### 16.1.1 Python 스타일 가이드
```python
"""
PEP 8 준수
- 들여쓰기: 4 spaces
- 라인 길이: 88자 (Black formatter)
- 클래스명: CamelCase
- 함수명: snake_case
- 상수: UPPER_SNAKE_CASE
"""

# 예시
class CameraManager:
    """카메라 관리 클래스"""

    MAX_CAMERAS = 16
    DEFAULT_TIMEOUT = 10

    def __init__(self):
        self._cameras: Dict[str, CameraStream] = {}

    def add_camera(self, camera_id: str, rtsp_url: str) -> bool:
        """카메라 추가

        Args:
            camera_id: 카메라 식별자
            rtsp_url: RTSP 스트림 URL

        Returns:
            성공 여부
        """
        try:
            camera = CameraStream(camera_id, rtsp_url)
            self._cameras[camera_id] = camera
            return True
        except Exception as e:
            logger.error(f"Failed to add camera: {e}")
            return False
```

#### 16.1.2 커밋 메시지 규칙
```
<type>(<scope>): <subject>

<body>

<footer>

Types:
- feat: 새로운 기능
- fix: 버그 수정
- docs: 문서 수정
- style: 코드 스타일 변경
- refactor: 리팩토링
- test: 테스트 추가/수정
- chore: 빌드, 패키지 매니저 등

예시:
feat(pipeline): 통합 파이프라인 구현

- Tee 엘리먼트를 사용한 스트림 분기
- Valve를 통한 동적 제어
- 50% CPU 사용률 감소

Closes #123
```

### 16.2 보안 고려사항

#### 16.2.1 필수 보안 사항
1. **RTSP 인증 정보 암호화**
   - 설정 파일의 비밀번호 암호화
   - 환경 변수 사용 권장

2. **입력 검증**
   - RTSP URL 유효성 검사
   - 파일 경로 sanitization
   - SQL 인젝션 방지

3. **접근 제어**
   - 최소 권한 원칙
   - 디렉토리 권한 설정

4. **로깅**
   - 민감 정보 마스킹
   - 감사 로그 유지

```python
# 보안 예시
from cryptography.fernet import Fernet

class SecurityManager:
    def encrypt_password(self, password: str) -> str:
        """비밀번호 암호화"""
        key = os.environ.get('ENCRYPTION_KEY')
        f = Fernet(key.encode())
        return f.encrypt(password.encode()).decode()

    def validate_rtsp_url(self, url: str) -> bool:
        """RTSP URL 검증"""
        pattern = r'^rtsp://[\w\-\.]+(:[\d]+)?/[\w\-\./]*$'
        return bool(re.match(pattern, url))
```

### 16.3 성능 최적화 가이드

#### 16.3.1 GStreamer 최적화
```python
# 파이프라인 최적화 설정
PIPELINE_CONFIG = {
    "queue_size": 200,          # 큐 크기
    "max-size-buffers": 0,      # 무제한
    "max-size-time": 0,         # 무제한
    "max-size-bytes": 10485760, # 10MB
    "leaky": 2,                 # downstream
}

# 하드웨어 가속 활용
DECODER_PRIORITY = [
    "v4l2h264dec",    # V4L2 하드웨어 디코더
    "omxh264dec",     # OpenMAX 하드웨어 디코더
    "nvh264dec",      # NVIDIA 하드웨어 디코더
    "avdec_h264",     # 소프트웨어 폴백
]
```

#### 16.3.2 메모리 관리
```python
# 메모리 누수 방지
class ResourceManager:
    def __init__(self):
        self._resources = []

    def __enter__(self):
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        """자동 리소스 정리"""
        for resource in self._resources:
            try:
                resource.cleanup()
            except Exception as e:
                logger.error(f"Cleanup failed: {e}")
```

### 16.4 플랫폼별 고려사항

#### 16.4.1 Raspberry Pi 최적화
```bash
# GPU 메모리 할당 (/boot/config.txt)
gpu_mem=256

# 오버클럭 설정 (선택적)
arm_freq=1500
gpu_freq=500
over_voltage=4

# 카메라 모듈 활성화
start_x=1
gpu_mem=128
```

#### 16.4.2 Windows 호환성
```python
# 플랫폼별 처리
import platform

if platform.system() == "Windows":
    video_sink = "d3dvideosink"
    path_separator = "\\"
elif platform.system() == "Linux":
    video_sink = "glimagesink"
    path_separator = "/"
```

### 16.5 문서화 요구사항

#### 16.5.1 코드 문서화
- 모든 공개 API에 docstring 작성
- 복잡한 알고리즘에 주석 추가
- README.md 유지 관리

#### 16.5.2 사용자 문서
- 설치 가이드
- 사용자 매뉴얼
- FAQ
- 문제 해결 가이드

#### 16.5.3 API 문서
```python
"""
Sphinx를 사용한 자동 문서 생성
"""
# docs/conf.py
extensions = [
    'sphinx.ext.autodoc',
    'sphinx.ext.napoleon',
    'sphinx.ext.viewcode',
]
```

---

## 17. 부록

### 17.1 용어 정의

| 용어 | 설명 |
|------|------|
| NVR | Network Video Recorder, 네트워크 비디오 녹화기 |
| RTSP | Real Time Streaming Protocol, 실시간 스트리밍 프로토콜 |
| Tee | GStreamer에서 스트림을 분기하는 엘리먼트 |
| Valve | GStreamer에서 스트림 흐름을 제어하는 엘리먼트 |
| Pipeline | GStreamer의 미디어 처리 파이프라인 |
| OSD | On-Screen Display, 화면 표시 정보 |
| FPS | Frames Per Second, 초당 프레임 수 |

### 17.2 참조 문서

- [GStreamer Documentation](https://gstreamer.freedesktop.org/documentation/)
- [PyQt5 Documentation](https://www.riverbankcomputing.com/static/Docs/PyQt5/)
- [Python GObject Introspection](https://pygobject.readthedocs.io/)
- [RTSP Specification (RFC 2326)](https://tools.ietf.org/html/rfc2326)

### 17.3 연락처

| 역할 | 담당자 | 이메일 | 전화 |
|------|--------|--------|------|
| 프로젝트 관리자 | PM | pm@company.com | 02-xxxx-xxxx |
| 기술 리드 | Tech Lead | tech@company.com | 02-xxxx-xxxx |
| QA 리드 | QA Lead | qa@company.com | 02-xxxx-xxxx |

### 17.4 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0 | 2025-10-20 | System Architect | 초기 작성 |

---

## 문서 승인

| 역할 | 이름 | 서명 | 날짜 |
|------|------|------|------|
| 프로젝트 관리자 | | | |
| 기술 리드 | | | |
| 품질 관리 | | | |
| 고객 대표 | | | |

---

**END OF DOCUMENT**